{"remainingRequest":"D:\\实习\\宿舍管理系统\\dms\\node_modules\\babel-loader\\lib\\index.js!D:\\实习\\宿舍管理系统\\dms\\src\\permission.js","dependencies":[{"path":"D:\\实习\\宿舍管理系统\\dms\\src\\permission.js","mtime":1644741256000},{"path":"D:\\实习\\宿舍管理系统\\dms\\babel.config.js","mtime":1644741256000},{"path":"D:\\实习\\宿舍管理系统\\dms\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\实习\\宿舍管理系统\\dms\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHJvdXRlciBmcm9tICIuL3JvdXRlciI7CmltcG9ydCBzdG9yZSBmcm9tICIuL3N0b3JlIjsKaW1wb3J0IHsgcmVzb2x2ZVJvdXRlciB9IGZyb20gJy4vQ29tcG9uZW50c01hcCc7CmltcG9ydCB7IGdldFRva2VuLCBzZXRUb2tlbiB9IGZyb20gIi4vdXRpbHMvYXV0aCI7CmltcG9ydCB7IGNvdW50VW5yZWFkLCBnZXRJbmZvIH0gZnJvbSAiLi9hcGkvbG9naW4iOwppbXBvcnQgeyBOb3RpZmljYXRpb24gfSBmcm9tICdlbGVtZW50LXVpJzsKcm91dGVyLmJlZm9yZUVhY2goYXN5bmMgKHRvLCBmcm9tLCBuZXh0KSA9PiB7CiAgaWYgKHRvLm1ldGEudGl0bGUpIHsKICAgIGRvY3VtZW50LnRpdGxlID0gdG8ubWV0YS50aXRsZSB8fCAn5a2m55Sf5a6/6IiN566h55CG57O757ufJzsKICB9CgogIGxldCBoYXNUb2tlID0gZ2V0VG9rZW4oKTsKCiAgaWYgKGhhc1Rva2UpIHsKICAgIGlmIChzdG9yZS5zdGF0ZS5oYXNSb2xlKSB7CiAgICAgIGlmICh0by5tYXRjaGVkLmxlbmd0aCA9PT0gMCkgewogICAgICAgIG5leHQoJy80MDQnKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgc3RvcmUuY29tbWl0KCdTRVRfSEFTX1JPTEUnLCB0cnVlKTsKICAgICAgY29uc3QgewogICAgICAgIGRhdGEKICAgICAgfSA9IGF3YWl0IGdldEluZm8oKTsKCiAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgY29uc3QgY291bnQgPSBhd2FpdCBjb3VudFVucmVhZCgpOwoKICAgICAgICBpZiAoY291bnQpIHsKICAgICAgICAgIHN0b3JlLmNvbW1pdCgnU0VUX0NPVU5UX1VOUkVBRCcsIGNvdW50LmRhdGEpOwogICAgICAgIH0KCiAgICAgICAgc3RvcmUuY29tbWl0KCdTRVRfUEVSTUlTU0lPTicsIGRhdGEucGVybWlzc2lvbnMpOwogICAgICAgIHN0b3JlLmNvbW1pdCgnU0VUX01FTlUnLCBkYXRhLmZ1bmN0aW9ucyk7CiAgICAgICAgc3RvcmUuY29tbWl0KCdTRVRfVVNFUl9OQU1FJywgZGF0YS5yZWFsTmFtZSk7CgogICAgICAgIGlmIChkYXRhLmljb24pIHsKICAgICAgICAgIHN0b3JlLmNvbW1pdCgnU0VUX1VTRVJfSUNPTicsIHByb2Nlc3MuZW52LlZVRV9BUFBfSU1HX1BSRUZJWCArIGRhdGEuaWNvbik7CiAgICAgICAgfSAvL+i/nuaOpXNvY2tldAoKCiAgICAgICAgbGV0IHNvY2tldCA9IGF3YWl0IG5ldyBXZWJTb2NrZXQocHJvY2Vzcy5lbnYuVlVFX0FQUF9XRUJTT0NLRVQgKyBkYXRhLmxvZ2luTmFtZSk7CgogICAgICAgIHNvY2tldC5vbm1lc3NhZ2UgPSBhc3luYyBldiA9PiB7CiAgICAgICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2UoZXYuZGF0YSk7CiAgICAgICAgICBjb25zdCBjb3VudCA9IGF3YWl0IGNvdW50VW5yZWFkKCk7CgogICAgICAgICAgaWYgKGNvdW50KSB7CiAgICAgICAgICAgIHN0b3JlLmNvbW1pdCgnU0VUX0NPVU5UX1VOUkVBRCcsIGNvdW50LmRhdGEpOwogICAgICAgICAgfQoKICAgICAgICAgIGlmIChkYXRhLnR5cGUgPT09IDEpIHsKICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSAiIjsKCiAgICAgICAgICAgIGlmIChkYXRhLm1lc3NhZ2VCb2R5Lmxlbmd0aCA8IDE1KSB7CiAgICAgICAgICAgICAgbWVzc2FnZSA9IGRhdGEuZnJvbSArICI6IiArIGRhdGEubWVzc2FnZUJvZHk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgbWVzc2FnZSA9IGRhdGEuZnJvbSArICI6IiArIGRhdGEubWVzc2FnZUJvZHkuc3Vic3RyKDAsIDE1KSArICIuLi4iOwogICAgICAgICAgICB9CgogICAgICAgICAgICBOb3RpZmljYXRpb24oewogICAgICAgICAgICAgIHRpdGxlOiBkYXRhLnRpdGxlLAogICAgICAgICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgICAgICAgICAgb2Zmc2V0OiA1MAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YS50eXBlID09PSAyKSB7CiAgICAgICAgICAgIE5vdGlmaWNhdGlvbih7CiAgICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsCiAgICAgICAgICAgICAgbWVzc2FnZTogIumAgOWuv+eQhueUse+8miIgKyBkYXRhLm1lc3NhZ2VCb2R5LAogICAgICAgICAgICAgIG9mZnNldDogNTAKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgc29ja2V0Lm9uY2xvc2UgPSAoKSA9PiB7CiAgICAgICAgICBOb3RpZmljYXRpb24oewogICAgICAgICAgICB0aXRsZTogJ+i/nuaOpeS4reaWrScsCiAgICAgICAgICAgIG1lc3NhZ2U6ICdzb2NrZXTov57mjqXkuK3mlq3vvIzlsJ3or5XliLfmlrDmtY/op4jlmagnLAogICAgICAgICAgICB0eXBlOiAnZXJyb3InCiAgICAgICAgICB9KTsKICAgICAgICB9OwoKICAgICAgICBzdG9yZS5jb21taXQoJ1NFVF9TT0NLRVQnLCBzb2NrZXQpOwogICAgICAgIGxldCByb3UgPSBbXTsKICAgICAgICByZXNvbHZlUm91dGVyKGRhdGEuZnVuY3Rpb25zLCByb3UpOwogICAgICAgIGF3YWl0IHJvdXRlci5hZGRSb3V0ZXMocm91KTsKICAgICAgICBuZXh0KHsgLi4udG8sCiAgICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgY29uc3QgaGFzaCA9IHt9OwogICAgY29uc3QgYXJyID0gdG8ucGF0aC5zdWJzdHJpbmcoMSkuc3BsaXQoL1s9Jl0vKTsKCiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkgPSBpICsgMikgewogICAgICBpZiAoYXJyW2ldKSBoYXNoW2FycltpXV0gPSBhcnJbaSArIDFdOwogICAgfQoKICAgIGlmIChoYXNoWyd0b2tlbiddKSB7CiAgICAgIHNldFRva2VuKGhhc2hbJ3Rva2VuJ10pOwogICAgICBuZXh0KCIvaW5kZXgiKTsKICAgIH0gZWxzZSB7CiAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gcHJvY2Vzcy5lbnYuVlVFX0FQUF9TU087CiAgICB9CiAgfQoKICBuZXh0KCk7Cn0pOw=="},{"version":3,"names":["router","store","resolveRouter","getToken","setToken","countUnread","getInfo","Notification","beforeEach","to","from","next","meta","title","document","hasToke","state","hasRole","matched","length","commit","data","count","permissions","functions","realName","icon","process","env","VUE_APP_IMG_PREFIX","socket","WebSocket","VUE_APP_WEBSOCKET","loginName","onmessage","ev","JSON","parse","type","message","messageBody","substr","offset","onclose","rou","addRoutes","replace","hash","arr","path","substring","split","i","window","location","href","VUE_APP_SSO"],"sources":["D:/实习/宿舍管理系统/dms/src/permission.js"],"sourcesContent":["import router from \"./router\";\r\nimport store from \"./store\";\r\nimport {resolveRouter} from './ComponentsMap'\r\nimport {getToken, setToken} from \"./utils/auth\";\r\nimport {countUnread, getInfo} from \"./api/login\";\r\nimport {Notification} from 'element-ui';\r\n\r\nrouter.beforeEach(async (to, from, next) => {\r\n    if (to.meta.title) {\r\n        document.title = to.meta.title || '学生宿舍管理系统'\r\n    }\r\n    let hasToke = getToken()\r\n\r\n    if (hasToke) {\r\n        if (store.state.hasRole) {\r\n            if (to.matched.length === 0) {\r\n                next('/404')\r\n            }\r\n        } else {\r\n            store.commit('SET_HAS_ROLE', true)\r\n            const {data} = await getInfo()\r\n            if (data) {\r\n                const count = await countUnread()\r\n                if (count) {\r\n                    store.commit('SET_COUNT_UNREAD', count.data)\r\n                }\r\n                store.commit('SET_PERMISSION', data.permissions)\r\n                store.commit('SET_MENU', data.functions)\r\n                store.commit('SET_USER_NAME', data.realName)\r\n                if (data.icon) {\r\n                    store.commit('SET_USER_ICON', process.env.VUE_APP_IMG_PREFIX + data.icon)\r\n                }\r\n                //连接socket\r\n                let socket = await new WebSocket(process.env.VUE_APP_WEBSOCKET + data.loginName)\r\n                socket.onmessage = async ev => {\r\n                    let data = JSON.parse(ev.data)\r\n                    const count = await countUnread()\r\n                    if (count) {\r\n                        store.commit('SET_COUNT_UNREAD', count.data)\r\n                    }\r\n                    if (data.type === 1) {\r\n                        let message = \"\"\r\n                        if(data.messageBody.length < 15) {\r\n                            message = data.from + \":\" + data.messageBody\r\n                        } else {\r\n                            message = data.from + \":\" + data.messageBody.substr(0, 15) + \"...\"\r\n                        }\r\n                        Notification({\r\n                            title: data.title,\r\n                            message: message,\r\n                            offset: 50\r\n                        });\r\n                    } else if (data.type === 2){\r\n                        Notification({\r\n                            title: data.title,\r\n                            message: \"退宿理由：\" + data.messageBody,\r\n                            offset: 50\r\n                        });\r\n                    }\r\n                }\r\n                socket.onclose = () => {\r\n                    Notification({\r\n                        title: '连接中断',\r\n                        message: 'socket连接中断，尝试刷新浏览器',\r\n                        type: 'error'\r\n                    });\r\n                }\r\n                store.commit('SET_SOCKET', socket)\r\n                let rou = []\r\n                resolveRouter(data.functions, rou)\r\n                await router.addRoutes(rou)\r\n                next({...to, replace: true})\r\n            }\r\n        }\r\n    } else {\r\n        const hash = {};\r\n        const arr = to.path.substring(1).split(/[=&]/)\r\n        for (let i = 0; i < arr.length; i = i + 2) {\r\n            if (arr[i]) hash[arr[i]] = arr[i + 1]\r\n        }\r\n        if (hash['token']) {\r\n            setToken(hash['token'])\r\n            next(\"/index\")\r\n        } else {\r\n            window.location.href = process.env.VUE_APP_SSO\r\n        }\r\n    }\r\n    next()\r\n})\r\n"],"mappings":"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"}]}